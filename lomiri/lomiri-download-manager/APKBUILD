# Maintainer: Luca Weiss <luca@z3ntu.xyz>
# Contributor: Bart Ribbers <bribbers@disroot.org>
# Contributor: Antoni Aloy <aaloytorrens@gmail.com>
pkgname=lomiri-download-manager
pkgver=0_git20230104
pkgrel=0
_commit="f48099c8da66f71c2268f5a340e8799db5038b20"
pkgdesc="Provides a service for downloading files while an application is suspended"
arch="all"
url="https://gitlab.com/ubports/development/core/lomiri-download-manager"
license="LGPL-3.0-only"
depends_dev="qt5-qtdeclarative-dev boost-dev glog-dev lomiri-api-dev"
makedepends="$depends_dev cmake cmake-extras gtest-dev gmock doxygen"
checkdepends="dbus-test-runner xvfb-run"
source="https://gitlab.com/ubports/development/core/lomiri-download-manager/-/archive/$_commit/lomiri-download-manager-$_commit.tar.gz
	0001-Disable-Werror.patch"
subpackages="$pkgname-dev $pkgname-doc"
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBEXECDIR=/usr/lib \
		-DCMAKE_INSTALL_LIBDIR=lib
	cmake --build build
}

check() {
	cd build
	# client_test_* tests time out under QEMU
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest -E "client_test_*"
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
771d8665aea6f255611503d3882a2d76faeedfe9e2e7a96ee3cae4f0480562a9d525c3b509a609b503e97b3cb454900cafc9154a08835ca35f59a3128bbcc54a  lomiri-download-manager-f48099c8da66f71c2268f5a340e8799db5038b20.tar.gz
2f7465955e0aeb583a2b1c13b4faa34f1dbeb251d87a476639f36198218ace071239447ee3e137c023bb1a9ea304f6c9331eff5aeb54e0d5e660a50a5326cbc4  0001-Disable-Werror.patch
"
